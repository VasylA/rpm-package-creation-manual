<head>
<link rel="stylesheet" type="text/css" href="qrc:///StyleSheets/Help/general.css">
<meta charset="UTF-8">
</head>
<body>
	<p>The <strong>Counter/Delay (CNT/DLY)</strong> macrocell is a multi-function component.  A CNT/DLY component may include the following functions: counter, delay, finite state machine (FSM), edge detector, wake-sleep controller (WS Ctrl), frequency detector and one-shot.  As a counter, the macrocell counts to the given register value and creates a pulse when it has reached the value or is reset. As a delay, it postpones rising and/or falling edges for the duration of the register value. As a finite state machine, the counter&#8217;s data can be manipulated up or down. As an edge detector, the macrocell generates a pulse on a rising and/or falling edge. As a Wake-Sleep controller, the macrocell controls the power up/down of analog blocks ADC and ACMP. As a frequency detector, the macro-cell is a watchdog timer and signifies if the input frequency is too slow. As a One-Shot macrocell, an input edge triggers a one-shot of counter-data length.</p>

	<h4>Parameters</h4><hr>

	<h3>Mode:</h3>

<p>
	<p class = "li1">• <strong>Delay</strong>: postpones the rising and/or falling edge of the input signal;</p>
	<p class = "li1">• <strong>Counter/FSM</strong>: generates a positive pulse when value is reached, or when reset;</p>
	<p class = "li1">• <strong>Edge detect</strong>: generates a pulse on a rising and/or falling edge;</p>
	<p class = "li1">• <strong>WS Ctrl</strong>: generates on and off signals to ADC and ACMP</p>
	<p class = "li1">• <strong>One-Shot</strong>: generates a long high pulse.</p>
	<p class = "li1">• <strong>Freq Detect</strong>: signifies if the input frequency is too slow.</p><br />
</p>

	<h3>Counter data:</h3>

	<p style="margin-left:2em;">The length of Counter/Delay period. CNT/DLY bit widths are 16-bit or 8-bit, from 1 to 65535 or 1 to 255 respectively. It is recommended to use larger counter data values for less error.</p>

	<h3>Delay time / Output Period:</h3>

	<p style="margin-left:2em;">Calculates time period with the following formulas: </p>

<p>
	<p class = "li1">• <strong>Output Period</strong>: [(Counter data + 1) / CLK input frequency &#8211; Offset];</p>
	<p class = "li1">• <strong>Delay time</strong>: [(Counter data + 2) / CLK input frequency &#8211; Offset];</p><br />
</p>

	<p style="margin-left:2em;">CLK Input Frequency is the frequency of the selected Clock Source and Offset is the asynchronous time offset between the input signal and the first clock pulse.</p>

	<p style="margin-left:2em;">If an input pulse is &lt; delay time, the pulse would be filtered out. This feature can be useful for de-glitching.</p>

	<h3>Edge select:</h3>

	<p style="margin-left:2em;">In Delay or edge detect mode, select which edge to delay. In Counter Mode with Reset In, select which edge resets the counter to 0.</p>

<p>
	<p class = "li1">• <strong>Both</strong>: both rising and falling edges of pulse are delayed;</p>
	<p class = "li1">• <strong>Falling</strong>: only falling edge delayed;</p>
	<p class = "li1">• <strong>Rising</strong>: only rising edge delayed;</p>
	<p class = "li1">• <strong>High Level Reset</strong>: When RESET IN is high, counter is reset to 0;</p><br />
</p>

	<h3>Output polarity:</h3>

	<p style="margin-left:2em;">Invert the polarity of the macro-cell output.</p>

	<h3>Q mode:</h3>

	<p style="margin-left:2em;">The Q mode selects the reset function for a counter/FSM when the data wraps around at 0 or max value. Set would load the counter/FSM data from a source, and Reset would load a zero. </p>

<p>
	<p class = "li1">• <strong>Set</strong>: loads either the design counter data, ADC data, or SPI data. Source data is selectable through the parameter &#8216;FSM data&#8217; under &#8216;Connections&#8217;;</p>
	<p class = "li1">• <strong>Reset</strong>: loads 0;</p><br />
</p>

	<h4>FSM inputs</h4><hr>

	<p style="margin-left:2em;">In FSM mode, the user may control the counter value using macro-cell inputs “UP, DOWN, KEEP” . </p>

	<p>UP: macro-cell input &#8216;UP’ is a count direction controller. A digital high sets the FSM to count up in value. A digital low sets the FSM to count down in value and both will wrap around at 0 or maximum.</p>

	<p style="margin-left:2em;">KEEP: macro-cell input &#8216;KEEP’ is a latching mechanism. A digital high latches the current value in FSM until &#8216;KEEP’ is released low. A digital low resumes normal operation where a clock input will increment or decrement its counter value. </p>

<p>
	<p class = "li1">• <strong>Counter data source</strong>: The FSM data will start at this number. When reaching 0 or max16-bit the FSM will not reload this value but instead wraps around;</p><br />
</p>

	<h3>Stop and restart:</h3>

	<p style="margin-left:2em;">In FSM mode, the RESET_IN input can stop and restart the FSM.</p>

	<p><em>For more detailed information, see datasheet section CNT/DLY Timing Diagram</em></p>

	<h4>WAKE SLEEP CONTROLLER parameters</h4><hr>

	<p style="margin-left:2em;">Use WS Ctrl for controlling the power on and power off of analog blocks ACMP and ADC. WS Ctrl frequency is sourced by the OSC. The sleep will turn off the regulator and bandgap.</p>

	<h3>ACMPx wake sleep:</h3>

	<p style="margin-left:2em;">Enable/Disable this wake sleep control to ALL ACMPs. ACMP PWR UP has highest priority.</p>

	<h3>ADC wake sleep:</h3>

	<p style="margin-left:2em;">Enable/Disable this wake sleep control to ADC. ADC PWR DN has highest priority.</p>

	<h3>Wake sleep output state:</h3>

	<p>When the OSC is powered down, chose whether the Analog Blocks stay in sleep mode or wake mode.</p>

<p>
	<p class = "li1">• <strong>Force sleep (LOW)</strong>: when OSC is powered down;</p>
	<p class = "li1">• <strong>Force wake (HIGH)</strong>: when OSC is powered down;</p><br />
</p>

	<h4>CONNECTIONS</h4><hr>

	<h3>RESET IN</h3>

	<p style="margin-left:2em;">Reset In resets the Counter to 0 when the RESET IN input has a valid edge. The edge is determined by the Edge select parameter. Valid in Counter Mode only.<br />
The initial output after reset is High for the duration of one clock cycle.</p>

	<h3>Clock</h3>

	<p style="margin-left:2em;">All Counter/Delays have OSC0/1/4/12/24/64, OSC1, and Ext Clock connections.</p>

	<h3>Clock Source:</h3>

	<p style="margin-left:2em;">Both counter and delay configurations can be sourced by an internal or external oscillator. Internal clock (OSC0, OSC1) without divider connections are not shown. (See OSC Info block for more information on the different CLK sources.)</p>

	<h4>Reset Condition Errata:</h4><hr>

	<p>If the Counter Reset is asserted at the same time as a rising clock edge, it is possible that the Counter Data will be reset incorrectly and the counter output may appear faster than expected. This phenomenon appears more often as the clock frequency increases. Refer to SLG46531 Errata Sheet for more information.</p>
</body>
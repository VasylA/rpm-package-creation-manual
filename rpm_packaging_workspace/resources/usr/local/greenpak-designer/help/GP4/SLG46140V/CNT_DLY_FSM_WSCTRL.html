<head>
<link rel="stylesheet" type="text/css" href="qrc:///StyleSheets/Help/general.css">
<meta charset="UTF-8">
</head>
<body>
	<p>The CNT/DLY macrocell is a multi-function component.  A CNT/DLY component may include the following functions: counter, delay, finite state machine (FSM), edge detector, or wake-sleep controller (WS Ctrl).  As a counter, the macrocell counts to the given register value and creates a pulse when it has reached the value or is reset. As a delay, it postpones rising and/or falling edges for the duration of the register value. As a finite state machine, the counter&#8217;s data can be manipulated up or down. As an edge detector, the macrocell generates a pulse on a rising and/or falling edge. As a Wake-Sleep controller, the macrocell controls the power up/down of analog blocks ADC and ACMP.</p>

	<h4>CNT/DLY Parameters</h4><hr>

	<h3>Mode:</h3>

<p>
	<p class = "li1">• <strong>Delay</strong>: postpones the rising and/or falling edge of the input signal;</p>
	<p class = "li1">• <strong>Counter/FSM</strong>: generates a positive pulse when value is reached, or when reset;</p>
	<p class = "li1">• <strong>Edge detect</strong>: generates a pulse on a rising and/or falling edge;</p><br />
</p>

	<h3>Counter data:</h3>

	<p style="margin-left:2em;">The length of Counter/Delay period. CNT/DLY bit widths are 14-bit or 8-bit, from 1 to 16383 or 1 to 255 respectively. For delay timing applications, it is recommended to use larger counter data values for less error.</p>

	<h3>Delay time / Output period:</h3>

	<p style="margin-left:2em;">Calculates time period with the following formulas: </p>

<p>
	<p class = "li1">• <strong>Output period</strong>: [(Counter data + 1) / CLK input frequency &#8211; Offset];</p>
	<p class = "li1">• <strong>Delay time</strong>: [(Counter data + 2) / CLK input frequency &#8211; Offset];</p><br />
</p>

	<p style="margin-left:2em;">CLK Input Frequency is the frequency of the selected Clock Source and Offset is the asynchronous time offset between the input signal and the first clock pulse.</p>

	<p style="margin-left:2em;">If an input pulse is &lt; delay time, the pulse would be filtered out. This feature can be useful for de-glitching.</p>

	<h3>Edge select:</h3>

	<p style="margin-left:2em;">In Delay or edge detect mode, select which edge to delay. In Counter Mode with Reset In, select which edge resets the counter to 0.</p>

<p>
	<p class = "li1">• <strong>Both</strong>: both rising and falling edges of pulse are delayed;</p>
	<p class = "li1">• <strong>Falling</strong>: only falling edge delayed;</p>
	<p class = "li1">• <strong>Rising</strong>: only rising edge delayed;</p>
	<p class = "li1">• <strong>High Level Reset</strong>: When RESET IN is high, counter is reset to 0;</p><br />
</p>

	<h3>Q mode:</h3>

	<p style="margin-left:2em;">The Q mode selects the reset function for a counter/FSM when the data wraps around at 0 or max value. Set would load the counter/FSM data from a source, and Reset would load a zero. </p>

<p>
	<p class = "li1">• <strong>Set</strong>: loads either the design counter data, ADC data, or SPI data. Source data is selectable through the parameter &#8216;FSM data&#8217; under &#8216;Connections&#8217;;</p>
	<p class = "li1">• <strong>Reset</strong>: loads 0;</p><br />
</p>

	<p><em>For more detailed information, see datasheet section 14.1.2 Counter Mode</em></p>

	<h3>FSM inputs:</h3>

	<p style="margin-left:2em;">In FSM mode, the user may control the counter value using macro-cell inputs “UP, DOWN, KEEP” . </p>

	<p>UP: macro-cell input &#8216;UP’ is a count direction controller. A digital high sets the FSM to count up in value. A digital low sets the FSM to count down in value and both will wrap around at 0 or maximum.</p>

	<p style="margin-left:2em;">KEEP: macro-cell input &#8216;KEEP’ is a latching mechanism. A digital high latches the current value in FSM until &#8216;KEEP’ is released low. A digital low resumes normal operation where a clock input will increment or decrement its counter value. </p>

<p>
	<p class = "li1">• <strong>Counter data source</strong>: The FSM data will start at this number. When reaching 0 or max16-bit the FSM will not reload this value but instead wraps around;</p><br />
</p>

	<p><em>For more detailed information, see datasheet section 14.1.3 FSM Mode</em></p>

	<h4>WAKE SLEEP CONTROLLER Parameters</h4><hr>

	<p style="margin-left:2em;">Use WS Ctrl for controlling the power on and power off of analog blocks ACMP and ADC. WS Ctrl frequency is sourced by the LF OSC. The sleep will turn off the regulator and bandgap.</p>

	<h3>ACMPx wake sleep:</h3>

	<p style="margin-left:2em;">Enable/Disable this wake sleep control to ALL ACMPs. ACMP PWR UP has highest priority.</p>

	<h3>ADC wake sleep:</h3>

	<p style="margin-left:2em;">Enable/Disable this wake sleep control to ADC. ADC PWR DN has highest priority.</p>

	<h3>Wake Sleep output state:</h3>

	<p style="margin-left:2em;">When the LF OSC is powered down, chose whether the Analog Blocks stay in sleep mode or wake mode.</p>

<p>
	<p class = "li1">• <strong>Force sleep (LOW)</strong>: when LF OSC is powered down;</p>
	<p class = "li1">• <strong>Force wake (HIGH)</strong>: when LF OSC is powered down;</p><br />
</p>

	<h4>CONNECTIONS</h4><hr>

	<h3>RESET IN</h3>

	<p style="margin-left:2em;">Reset In resets the Counter to 0 when the RESET IN input has a valid edge. The edge is determined by the Edge select parameter. Valid in Counter Mode only.<br />
The initial output after reset is High for the duration of one clock cycle.</p>

	<h3>Clock</h3>

	<p style="margin-left:2em;">All Counter/Delays have CLK/4/12/24/64, Ring OSC, LFOSC, ADC_CLK/256, EXT CLK0/8 and EXTCLK1 connections. Each CNT/DLY can be sourced by another CNT/DLY (view table below).</p>

	<p><em><strong>Table 1.</strong></em>
	<table border="1" style="border-color: #808080; border-width: 1px;" cellspacing="0" cellpadding="5">
		<tr>
			<th>Macrocell </th>
			<th>Bit-Width </th>
			<th>CNT/DLY         </th>
		</tr>
		<tr>
			<td style="text-align:center;">CNT/DLY0  </td>
			<td style="text-align:center;">14        </td>
			<td style="text-align:center;">8-bit CNT/DLY3  </td>
		</tr>
		<tr>
			<td style="text-align:center;">CNT/DLY1  </td>
			<td style="text-align:center;">8         </td>
			<td style="text-align:center;">14-bit CNT/DLY0 </td>
		</tr>
		<tr>
			<td style="text-align:center;">CNT/DLY2  </td>
			<td style="text-align:center;">14        </td>
			<td style="text-align:center;">8-bit CNT/DLY1  </td>
		</tr>
		<tr>
			<td style="text-align:center;">CNT/DLY3  </td>
			<td style="text-align:center;">8         </td>
			<td style="text-align:center;">14-bit CNT/DLY2 </td>
		</tr>
	</table></p>

	<h3>Clock source:</h3>

	<p style="margin-left:2em;">Both Counter and Delay configurations can be sourced by an internal or external oscillator. Clock (RC OSC) without divider connections are not shown. (See OSC Info block for more information on the different CLK sources.)</p>
</body>